<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Website Builder</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
</style>
</head>

<body class="bg-gray-100">

<div class="flex flex-1 overflow-hidden">

<!-- ================= SIDEBAR ================= -->
<aside class="w-64 bg-white border-r flex flex-col">

  <div class="p-4 border-b">
    <button id="newProjectBtn"
      class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
      + New Project
    </button>
  </div>

  <div id="projectList" class="flex-1 overflow-y-auto p-2 space-y-2"></div>

  <div class="p-4 border-t">
    <button id="settingsBtn" class="text-gray-600 hover:text-black text-xl">âš™ï¸</button>
  </div>

</aside>

<!-- ================= MAIN ================= -->
<main class="flex flex-col flex-1 overflow-hidden">

<header class="flex items-center justify-between bg-white border-b px-4 py-2">

  <div class="flex space-x-2">
    <span>ğŸ”´</span><span>ğŸŸ¡</span><span>ğŸŸ¢</span>
  </div>

  <div class="flex space-x-2">
    <button id="previewBtn" class="px-3 py-1 bg-blue-500 text-white rounded">Preview</button>
    <button id="codeBtn" class="px-3 py-1 bg-gray-300 rounded">Code</button>
  </div>

  <button id="downloadBtn" class="bg-green-600 text-white px-3 py-1 rounded">
    Download
  </button>

</header>

<div class="flex-1 overflow-hidden">

  <iframe id="previewFrame" class="w-full h-full bg-white"></iframe>

  <pre id="codeView"
    class="hidden w-full h-full overflow-auto p-4 text-sm bg-black text-green-400"></pre>

</div>

<footer class="border-t bg-white p-3 flex space-x-2 flex-shrink-0">
  <textarea id="promptInput"
    class="flex-1 border rounded p-2 resize-none"
    rows="2"
    placeholder="Describe your website..."></textarea>
  <button id="sendBtn"
    class="bg-blue-600 text-white px-4 rounded">
    Send
  </button>
</footer>

</main>
</div>

<!-- ================= LOADER ================= -->
<div id="loader"
  class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg">Generating...</div>
</div>

<!-- ================= SETTINGS MODAL ================= -->
<div id="settingsModal"
  class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">

  <div class="bg-white p-6 rounded-lg w-96 space-y-3">

    <h2 class="text-lg font-semibold">Settings</h2>

    <input id="apiUrlInput" class="w-full border p-2 rounded" />
    <input id="apiKeyInput" type="password"
      class="w-full border p-2 rounded" />
    <input id="modelInput" class="w-full border p-2 rounded" />

    <div class="flex justify-end space-x-2">
      <button id="saveSettingsBtn"
        class="bg-blue-600 text-white px-4 py-1 rounded">Save</button>
      <button id="closeSettingsBtn"
        class="bg-gray-300 px-4 py-1 rounded">Close</button>
    </div>

  </div>
</div>

<script>
/* ================= SYSTEM PROMPT ================= */
const SYSTEM_PROMPT =
"You are a web developer. Output ONLY raw HTML code. No explanations.";

/* ================= DEFAULT SETTINGS ================= */
const DEFAULT_SETTINGS = {
  apiUrl: "https://openrouter.ai/api/v1/chat/completions",
  apiKey: "",
  model: "deepseek/deepseek-r1:free"
};

/* ================= STATE ================= */
let projects = JSON.parse(localStorage.getItem("projects") || "[]");
let currentProjectId = localStorage.getItem("currentProjectId");

/* ================= SETTINGS ================= */
function loadSettings() {
  return JSON.parse(localStorage.getItem("settings") || JSON.stringify(DEFAULT_SETTINGS));
}

function saveSettings(settings) {
  localStorage.setItem("settings", JSON.stringify(settings));
}

/* ================= PROJECT FUNCTIONS ================= */
function saveProjects() {
  localStorage.setItem("projects", JSON.stringify(projects));
}

function createProject() {
  const id = Date.now().toString();
  const project = {
    id,
    name: "Project " + (projects.length + 1),
    html: "",
    messages: []   // ğŸ”¥ Chat history per project
  };
  projects.unshift(project);
  currentProjectId = id;
  localStorage.setItem("currentProjectId", id);
  saveProjects();
  renderProjects();
  loadCurrentProject();
}

function deleteProject(id) {
  projects = projects.filter(p => p.id !== id);
  if (currentProjectId === id) {
    currentProjectId = projects[0]?.id || null;
  }
  localStorage.setItem("currentProjectId", currentProjectId);
  saveProjects();
  renderProjects();
  loadCurrentProject();
}

function renderProjects() {
  const list = document.getElementById("projectList");
  list.innerHTML = "";

  projects.forEach(p => {
    const div = document.createElement("div");
    div.className =
      "flex justify-between items-center bg-gray-100 p-2 rounded cursor-pointer";

    div.innerHTML = `
      <span>${p.name}</span>
      <button class="text-red-500">ğŸ—‘</button>
    `;

    div.onclick = () => {
      currentProjectId = p.id;
      localStorage.setItem("currentProjectId", p.id);
      loadCurrentProject();
    };

    div.querySelector("button").onclick = (e) => {
      e.stopPropagation();
      deleteProject(p.id);
    };

    list.appendChild(div);
  });
}

function getCurrentProject() {
  return projects.find(p => p.id === currentProjectId);
}

function loadCurrentProject() {
  const project = getCurrentProject();
  if (!project) return;
  updatePreview(project.html);
}

/* ================= PREVIEW ================= */
const previewFrame = document.getElementById("previewFrame");
const codeView = document.getElementById("codeView");

function updatePreview(html) {
  previewFrame.srcdoc = html || "";
  codeView.textContent = html || "";
}

document.getElementById("previewBtn").onclick = () => {
  previewFrame.classList.remove("hidden");
  codeView.classList.add("hidden");
};

document.getElementById("codeBtn").onclick = () => {
  previewFrame.classList.add("hidden");
  codeView.classList.remove("hidden");
};

/* ================= DOWNLOAD ================= */
document.getElementById("downloadBtn").onclick = () => {
  const project = getCurrentProject();
  if (!project) return;

  const blob = new Blob([project.html], { type: "text/html" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "index.html";
  a.click();
};

/* ================= SEND ================= */
document.getElementById("sendBtn").onclick = async () => {

  const prompt = document.getElementById("promptInput").value.trim();
  if (!prompt) return;

  const settings = loadSettings();
  if (!settings.apiKey) {
    alert("Enter API key in settings");
    return;
  }

  const project = getCurrentProject();
  if (!project) return;

  document.getElementById("loader").classList.remove("hidden");

  try {

    // Add user message to history
    project.messages.push({ role: "us
